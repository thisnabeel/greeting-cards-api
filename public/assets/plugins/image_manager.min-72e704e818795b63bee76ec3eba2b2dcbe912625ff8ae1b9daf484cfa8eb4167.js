!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],a):a(e.FroalaEditor)}(this,function($){"use strict";if($=$&&$.hasOwnProperty("default")?$["default"]:$,Object.assign($.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:null,imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),$.PLUGINS.imageManager=function(s){function i(){var e=R(window).outerWidth();return e<768?2:e<1200?3:4}function o(){D.empty();for(var e=0;e<E;e++)D.append('<div class="fr-list-column"></div>')}function g(){if(S<I.length&&(D.outerHeight()<=C.outerHeight()+s.opts.imageManagerScrollOffset||C.scrollTop()+s.opts.imageManagerScrollOffset>D.outerHeight()-C.outerHeight())){P++;for(var e=s.opts.imageManagerPageSize*(P-1);e<Math.min(I.length,s.opts.imageManagerPageSize*P);e++)a(I[e])}}function a(n){var i=new Image,o=R(document.createElement("div")).attr("class","fr-image-container fr-empty fr-image-"+T++).attr("data-loading",s.language.translate("Loading")+"..").attr("data-deleting",s.language.translate("Deleting")+"..");m(!1),i.onload=function(){o.height(Math.floor(o.width()/i.width*i.height));var t=R(document.createElement("img"));if(n.thumb)t.attr("src",n.thumb);else{if(p(q,n),!n.url)return p(_,n),!1;t.attr("src",n.url)}if(n.url&&t.attr("data-url",n.url),n.tag)if(w.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),w.find(".fr-modal-tags").show(),0<=n.tag.indexOf(",")){for(var e=n.tag.split(","),a=0;a<e.length;a++)e[a]=e[a].trim(),0===y.find('a[title="'.concat(e[a],'"]')).length&&y.append('<a role="button" title="'.concat(e[a],'">').concat(e[a],"</a>"));t.attr("data-tag",e.join())}else 0===y.find('a[title="'.concat(n.tag.trim(),'"]')).length&&y.append('<a role="button" title="'.concat(n.tag.trim(),'">').concat(n.tag.trim(),"</a>")),t.attr("data-tag",n.tag.trim());for(var r in n.name&&t.attr("alt",n.name),n)n.hasOwnProperty(r)&&"thumb"!==r&&"url"!==r&&"tag"!==r&&t.attr("data-".concat(r),n[r]);o.append(t).append(R(s.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",s.language.translate("Delete"))).append(R(s.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",s.language.translate("Insert"))),y.find(".fr-selected-tag").each(function(e,a){M(t,a.text)||o.hide()}),t.on("load",function(){o.removeClass("fr-empty"),o.height("auto"),S++,d(l(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1)),m(!1),S%s.opts.imageManagerPageSize==0&&g()}),s.events.trigger("imageManager.imageLoaded",[t])},i.onerror=function(){S++,o.remove(),d(l(parseInt(o.attr("class").match(/fr-image-(\d+)/)[1],10)+1)),p(e,n),S%s.opts.imageManagerPageSize==0&&g()},i.src=n.thumb||n.url,t().append(o)}function t(){var r,n;return D.find(".fr-list-column").each(function(e,a){var t=R(a);0===e?(n=t.outerHeight(),r=t):t.outerHeight()<n&&(n=t.outerHeight(),r=t)}),r}function l(e){e===undefined&&(e=0);for(var a=[],t=T-1;e<=t;t--){var r=D.find(".fr-image-".concat(t));r.length&&(a.push(r),R(document.createElement("div")).attr("id","fr-image-hidden-container").append(r),D.find(".fr-image-".concat(t)).remove())}return a}function d(e){for(var a=e.length-1;0<=a;a--)t().append(e[a])}function m(e){if(e===undefined&&(e=!0),!b.isVisible())return!0;var a=i();if(a!==E){E=a;var t=l();o(),d(t)}s.modals.resize(U),e&&g()}function c(e){for(var a,t=e[0].attributes,r=t.length,n={};r--;)t[r]&&"src"!==(a=t[r].name)&&(n[a]=t[r].value);return n}function f(e){var a=R(e.currentTarget).siblings("img"),t=b.data("instance")||s,r=b.data("current-image");if(s.modals.hide(U),t.image.showProgressBar(),r)r.data("fr-old-src",r.attr("src")),r.trigger("click");else{t.events.focus(!0),t.selection.restore();var n=t.position.getBoundingRect(),i=n.left+n.width/2+R(s.doc).scrollLeft(),o=n.top+n.height+R(s.doc).scrollTop();t.popups.setContainer("image.insert",s.$sc),t.popups.show("image.insert",i,o)}t.image.insert(a.data("url"),!1,c(a),r)}function u(e){var r=R(e.currentTarget).siblings("img"),a=s.language.translate("Are you sure? Image will be deleted.");confirm(a)&&(s.opts.imageManagerDeleteURL?!1!==s.events.trigger("imageManager.beforeDeleteImage",[r])&&(r.parent().addClass("fr-image-deleting"),R(this).ajax({method:s.opts.imageManagerDeleteMethod,url:s.opts.imageManagerDeleteURL,data:Object.assign(Object.assign({src:r.attr("src")},c(r)),s.opts.imageManagerDeleteParams),crossDomain:s.opts.requestWithCORS,withCredentials:s.opts.requestWithCredentials,headers:s.opts.requestHeaders,done:function(e){s.events.trigger("imageManager.imageDeleted",[e]);var a=l(parseInt(r.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);r.parent().remove(),d(a),function t(){b.find("#fr-modal-tags > a").each(function(){0===b.find('#fr-image-list [data-tag*="'.concat(R(this).text(),'"]')).length&&R(this).removeClass("fr-selected-tag").hide()}),n()}(),m(!0)},fail:function(e){p(k,e.response||e.responseText)}})):p(j))}function p(e,a){10<=e&&e<20?L.hide():20<=e&&e<30&&R(".fr-image-deleting").removeClass("fr-image-deleting"),s.events.trigger("imageManager.error",[{code:e,message:r[e]},a])}function h(){var e=w.find(".fr-modal-head-line").outerHeight(),a=y.outerHeight();w.toggleClass("fr-show-tags"),w.hasClass("fr-show-tags")?(w.css("height",e+a),C.css("marginTop",e+a),y.find("a").css("opacity",1)):(w.css("height",e),C.css("marginTop",e),y.find("a").css("opacity",0))}function n(){var e=y.find(".fr-selected-tag");0<e.length?(D.find("img").parents().show(),e.each(function(e,r){D.find("img").each(function(e,a){var t=R(a);M(t,r.text)||t.parent().hide()})})):D.find("img").parents().show(),d(l()),g()}function v(e){e.preventDefault();var a=R(e.currentTarget);a.toggleClass("fr-selected-tag"),s.opts.imageManagerToggleTags&&a.siblings("a").removeClass("fr-selected-tag"),n()}function M(e,a){for(var t=(e.attr("data-tag")||"").split(","),r=0;r<t.length;r++)if(t[r]===a)return!0;return!1}var b,w,C,L,D,y,I,P,S,T,E,R=s.$,U="image_manager",e=10,x=11,H=12,O=13,q=14,_=15,k=21,j=22,r={};return r[e]="Image cannot be loaded from the passed link.",r[x]="Error during load images request.",r[H]="Missing imageManagerLoadURL option.",r[O]="Parsing load response failed.",r[q]="Missing image thumb.",r[_]="Missing image URL.",r[k]="Error during delete image request.",r[j]="Missing imageManagerDeleteURL option.",{require:["image"],_init:function z(){if(!s.$wp&&"IMG"!==s.el.tagName)return!1},show:function G(){if(!b){var e,a='<button class="fr-command fr-btn fr-modal-more fr-not-available" id="fr-modal-more-'.concat(s.sid,'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24""><path d="').concat($.SVG.tags,'"/></svg></button><h4 data-text="true">').concat(s.language.translate("Manage Images"),'</h4></div>\n      <div class="fr-modal-tags" id="fr-modal-tags">');e=s.opts.imageManagerPreloader?'<img class="fr-preloader" id="fr-preloader" alt="'.concat(s.language.translate("Loading"),'.." src="').concat(s.opts.imageManagerPreloader,'" style="display: none;">'):'<span class="fr-preloader" id="fr-preloader" style="display: none;">'.concat(s.language.translate("Loading"),"</span>"),e+='<div class="fr-image-list" id="fr-image-list"></div>';var t=s.modals.create(U,a,e);b=t.$modal,w=t.$head,C=t.$body}b.data("current-image",s.image.get()),s.modals.show(U),L||function r(){L=b.find("#fr-preloader"),D=b.find("#fr-image-list"),y=b.find("#fr-modal-tags"),E=i(),o(),w.css("height",w.find(".fr-modal-head-line").outerHeight()),s.events.$on(R(s.o_win),"resize",function(){m(!!I)}),s.events.bindClick(D,".fr-insert-img",f),s.events.bindClick(D,".fr-delete-img",u),s.helpers.isMobile()&&(s.events.bindClick(D,"div.fr-image-container",function(e){b.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),R(e.currentTarget).addClass("fr-mobile-selected")}),b.on(s._mousedown,function(){b.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),b.on(s._mousedown+" "+s._mouseup,function(e){e.stopPropagation()}),b.on(s._mousedown,"*",function(){s.events.disableBlur()}),C.on("scroll",g),s.events.bindClick(b,"button#fr-modal-more-".concat(s.sid),h),s.events.bindClick(y,"a",v)}(),function n(){L.show(),D.find(".fr-list-column").empty(),s.opts.imageManagerLoadURL?R(this).ajax({url:s.opts.imageManagerLoadURL,method:s.opts.imageManagerLoadMethod,data:s.opts.imageManagerLoadParams,crossDomain:s.opts.requestWithCORS,withCredentials:s.opts.requestWithCredentials,headers:s.opts.requestHeaders,done:function(e,a,t){s.events.trigger("imageManager.imagesLoaded",[e]),function r(e,a){try{D.find(".fr-list-column").empty(),T=S=P=0,I=JSON.parse(e),g()}catch(t){p(O,a)}}(e,t.response),L.hide()},fail:function(e){p(x,e.response||e.responseText)}}):p(H)}()},hide:function N(){s.modals.hide(U)}}},!$.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");$.DEFAULTS.imageInsertButtons.push("imageManager"),$.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,modal:!0,callback:function(){this.imageManager.show()},plugin:"imageManager"}),$.DefineIcon("imageManager",{NAME:"folder",SVG_KEY:"imageManager"}),$.DefineIcon("imageManagerInsert",{NAME:"plus",SVG_KEY:"add"}),$.DefineIcon("imageManagerDelete",{NAME:"trash",SVG_KEY:"remove"})});